<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="吴彦欣的笔记">
<meta property="og:url" content="http://wuyanxin.com/index.html">
<meta property="og:site_name" content="吴彦欣的笔记">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="吴彦欣的笔记">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> 吴彦欣的笔记 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '66375848-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?1f4eb91147ce76e9861be51f8771805d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">吴彦欣的笔记</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/try_nodejs_on_jenkins.html" itemprop="url">
                Jenkins+Node.js持续集成
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-19T10:31:36+08:00" content="2015-10-19">
            2015-10-19
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/node-js/" itemprop="url" rel="index">
                  <span itemprop="name">node.js</span>
                </a>
              </span>

              
              
                ， 
              

            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/node-js/jenkins/" itemprop="url" rel="index">
                  <span itemprop="name">jenkins</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/try_nodejs_on_jenkins.html#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="try_nodejs_on_jenkins.html" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p><img src="http://upload-images.jianshu.io/upload_images/436630-980297d7de13473d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="什么是持续集成(Continuous_integration)">什么是持续集成(<a href="http://www.martinfowler.com/articles/continuousIntegration.html" target="_blank" rel="external">Continuous integration</a>)</h3><blockquote>
<p>提出者Martin Fowler本人对持续集成是这样定义的:持续集成是一种软件开发实践，即团队开发成员经常集成他们的工作，通常每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动化测试)来验证，从而尽快地发现集成错误。许多团队发现这个过程可以大大减少集成的问题，让团队能够更快的开发内聚的软件。</p>
</blockquote>
<p>随着软件开发复杂度的不断提高，团队开发成员间如何更好地协同工作以确保软件开发的质量已经慢慢成为开发过程中不可回避的问题。尤其是敏捷开发（Agile） 在软件工程领域越来越红火，如何能再不断变化的需求中快速适应和保证软件的质量也显得尤其的重要。<br>持续集成正是针对这一类问题的一种软件开发实践。</p>
<h5 id="持续集成的核心价值在于：">持续集成的核心价值在于：</h5><ol>
<li>减少风险，减少重复过程</li>
<li>任何时间、任何地点生成可部署的软件</li>
<li>增强项目的可见性</li>
<li>建立团队对开发产品的信心</li>
</ol>
<h5 id="持续集成的原则">持续集成的原则</h5><ol>
<li>所有的开发人员需要在本地机器上做本地构建，然后再提交的版本控制库中，从而确保他们的变更不会导致持续集成失败。</li>
<li>开发人员每天至少向版本控制库中提交一次代码。</li>
<li>开发人员每天至少需要从版本控制库中更新一次代码到本地机器。</li>
<li>需要有专门的集成服务器来执行集成构建,每天要执行多次构建。</li>
<li>每次构建都要100%通过。</li>
<li>每次构建都可以生成可发布的产品。</li>
<li>修复失败的构建是优先级最高的事情。</li>
<li>测试是未来，未来是测试</li>
</ol>
<h3 id="Jenkins">Jenkins</h3><blockquote>
<p>Jenkins 是一个开源项目，提供了一种易于使用的持续集成系统，使开发者从繁杂的集成中解脱出来，专注于更为重要的业务逻辑实现上。同时 Jenkins 能实施监控集成中存在的错误，提供详细的日志文件和提醒功能，还能用图表的形式形象地展示项目构建的趋势和稳定性。</p>
</blockquote>
<h5 id="安装">安装</h5><p>从<a href="http://jenkins-ci.org/" target="_blank" rel="external">Jenkins官网</a>下载最新<a href="http://mirrors.jenkins-ci.org/war/latest/jenkins.war" target="_blank" rel="external">war文件</a></p>
<blockquote>
<p>运行 java -jar jenkins.war</p>
</blockquote>
<p>运行成功会在用户个人目录下新建.jenkins/文件夹<br>访问localhost:8080就能到达Jenkins首页</p>
<h5 id="系统配置">系统配置</h5><h6 id="邮件配置">邮件配置</h6><blockquote>
<p>系统管理 &gt;&gt; 系统设置 </p>
</blockquote>
<p>这里以<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=331" target="_blank" rel="external">QQ邮箱配置</a>为例，根据自己的邮件提供商修改<br><img src="http://upload-images.jianshu.io/upload_images/436630-78913887d94d388a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置有效URL和发送邮箱"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/436630-b364c2acb879da40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="注意SMTP服务器是系统管理员邮件提供商的服务器"></p>
<h6 id="安装Git插件">安装Git插件</h6><blockquote>
<p>系统管理 &gt;&gt; 插件管理 &gt;&gt; 可选插件</p>
</blockquote>
<p>查找Git plugin，勾选，直接安装，重启Jenkins</p>
<p>Jenkins提供了很多优秀的插件，这里有一篇不错的<a href="http://qa.blog.163.com/blog/static/190147002201391661510655/" target="_blank" rel="external">介绍Jenkins Job相关插件的文章</a><br>如果你觉得已有的插件不能满足你的需求，可以自己开发（推荐：<a href="http://www.ibm.com/developerworks/cn/java/j-lo-jenkins-plugin/" target="_blank" rel="external">浅析Jenkins插件开发</a>）</p>
<h5 id="用户与安全">用户与安全</h5><blockquote>
<p>系统管理 &gt;&gt; 管理用户  </p>
</blockquote>
<p>可添加和管理用户</p>
<blockquote>
<p>系统管理 &gt;&gt; Configure Global Security(安全设置) </p>
</blockquote>
<p>可配合安全矩阵管理用户权限</p>
<h3 id="DEMO">DEMO</h3><ol>
<li><p>新建一个freestyle项目<br><img src="http://upload-images.jianshu.io/upload_images/436630-3cfd98310e077484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>配置源码，这里以git为例，Credential可以配置帐号密码、ssh<br><a href="https://github.com/wuyanxin/jenkins_nodejs_test" target="_blank" rel="external">https://github.com/wuyanxin/jenkins_nodejs_test</a> 是一份简单示例代码，包含启动失败、启动成功、测试失败、和测试成功的例子<br><img src="http://upload-images.jianshu.io/upload_images/436630-3f42839992a1a840.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>构建触发器<br>我选择的是定时器模式，配置语法如crontab，可点击右侧的问号查看说明。<br>顺便说说触发远程构建，可以通过远程请求对应URL触发，这个可以配合版本库的hook使用，自动化测试新commit<br><img src="http://upload-images.jianshu.io/upload_images/436630-7687ef8e9ea6e4a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>构建<br>可通过四种方式构建，batch、shell、ant、maven，根据自己需要自行选择。<br>我用shell, 可以增加多步构建，按顺序执行<br><img src="http://upload-images.jianshu.io/upload_images/436630-9c9d2f120b8b1e0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/436630-542f8803b89aa1ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>构建之后<br>可打包、构建其他项目、发布测试报告、发布javadoc、git发布、邮件提醒<br>这里就只谈谈邮件提醒<br><img src="http://upload-images.jianshu.io/upload_images/436630-fa9607ccdbcc1bd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/436630-4f55ecc0bacb06a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="邮件提醒"></p>
<blockquote>
<p>这样我们就完成了持续集成环境的搭建，启动失败或者测试失败将会发送邮件通知。</p>
</blockquote>
</li>
<li><p>Jenkins面板还提供了构建晴雨表，表示最近5次构建的成功情况，按照下图5种晴雨表图标分别表示最近5个成功、4个成功，3个成功，1或2个成功，全部失败<br><img src="http://upload-images.jianshu.io/upload_images/436630-fb1d111c4f1802d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="构建晴雨表"></p>
</li>
</ol>
<p>未完待续…</p>
<h4 id="参考">参考</h4><p><a href="http://www.baidu.com/link?url=9mixigbSigIs3fV1i62iXlDVfd3DUCDmBs67NT0pq8jmnlAVPPMHR5knTb4_LRHOombfT8wrd28FLeUGJ36RzK&amp;wd=&amp;eqid=82a3f9d40002964400000005561fb823" target="_blank" rel="external">Jenkins_百度百科</a><br><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jenkins/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-lo-jenkins/</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/chatapp_build_by_socket_io_and_express.html" itemprop="url">
                socket.io+express多房间聊天应用
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-14T18:03:05+08:00" content="2015-08-14">
            2015-08-14
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/chatapp_build_by_socket_io_and_express.html#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="chatapp_build_by_socket_io_and_express.html" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="socket-io简介">socket.io简介</h3><p>Socket.IO是一个开源的WebSocket库，它通过Node.js实现WebSocket服务端，同时也提供客户端JS库。Socket.IO支持以事件为基础的实时双向通讯，它可以工作在任何平台、浏览器或移动设备。<br>Socket.IO支持4种协议：WebSocket、htmlfile、xhr-polling、jsonp-polling，它会自动根据浏览器选择适合的通讯方式，从而让开发者可以聚焦到功能的实现而不是平台的兼容性，同时Socket.IO具有不错的稳定性和性能。</p>
<h3 id="多房间聊天">多房间聊天</h3><p>socket.io提供<a href="http://socket.io/docs/rooms-and-namespaces/" target="_blank" rel="external">rooms和namespace的API</a><br>用rooms的API就可以实现多房间聊天了，总结出来无外乎就是：join/leave room 和 say to room<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// join和leave</span><br><span class="line">io.on('connection', function(socket)&#123;</span><br><span class="line">  socket.join('some <span class="keyword">room</span>');</span><br><span class="line">  // socket.leave('some <span class="keyword">room</span>');</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="keyword">say</span> to <span class="keyword">room</span></span><br><span class="line">io.to('some <span class="keyword">room</span>').emit('some event'):</span><br><span class="line">io.in('some <span class="keyword">room</span>').emit('some event'):</span><br></pre></td></tr></table></figure></p>
<h3 id="代码_github">代码 <a href="https://github.com/wuyanxin/chatapp-demo.git" target="_blank" rel="external">github</a></h3><p>新建文件夹chatapp-demo<br><code>chatapp-demo/package.json</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"chatapp-demo"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"multi room chat app demo, powered by socket.io"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"app.js"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">hbs</span>": <span class="value"><span class="string">"^3.1.0"</span></span>,</span><br><span class="line">    "<span class="attribute">path</span>": <span class="value"><span class="string">"^0.11.14"</span></span>,</span><br><span class="line">    "<span class="attribute">socket.io</span>": <span class="value"><span class="string">"^1.3.6"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">devDependencies</span>": <span class="value">&#123;&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"wuyanxin"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行 <code>npm install</code></p>
<h6 id="服务端代码">服务端代码</h6><p>增加文件 <code>chatapp-demo/app.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> IO = <span class="built_in">require</span>(<span class="string">'socket.io'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app);</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'hbs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建socket服务</span></span><br><span class="line"><span class="keyword">var</span> socketIO = IO(server);</span><br><span class="line"><span class="comment">// 房间用户名单</span></span><br><span class="line"><span class="keyword">var</span> roomInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">socketIO.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取请求建立socket连接的url</span></span><br><span class="line">  <span class="comment">// 如: http://localhost:3000/room/room_1, roomID为room_1</span></span><br><span class="line">  <span class="keyword">var</span> url = socket.request.headers.referer;</span><br><span class="line">  <span class="keyword">var</span> splited = url.split(<span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">var</span> roomID = splited[splited.length - <span class="number">1</span>];   <span class="comment">// 获取房间ID</span></span><br><span class="line">  <span class="keyword">var</span> user = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'join'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">userName</span>) </span>&#123;</span><br><span class="line">    user = userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将用户昵称加入房间名单中</span></span><br><span class="line">    <span class="keyword">if</span> (!roomInfo[roomID]) &#123;</span><br><span class="line">      roomInfo[roomID] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    roomInfo[roomID].push(user);</span><br><span class="line"></span><br><span class="line">    socket.join(roomID);    <span class="comment">// 加入房间</span></span><br><span class="line">    <span class="comment">// 通知房间内人员</span></span><br><span class="line">    socketIO.to(roomID).emit(<span class="string">'sys'</span>, user + <span class="string">'加入了房间'</span>, roomInfo[roomID]);  </span><br><span class="line">    <span class="built_in">console</span>.log(user + <span class="string">'加入了'</span> + roomID);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'leave'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    socket.emit(<span class="string">'disconnect'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 从房间名单中移除</span></span><br><span class="line">    <span class="keyword">var</span> index = roomInfo[roomID].indexOf(user);</span><br><span class="line">    <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">      roomInfo[roomID].splice(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    socket.leave(roomID);    <span class="comment">// 退出房间</span></span><br><span class="line">    socketIO.to(roomID).emit(<span class="string">'sys'</span>, user + <span class="string">'退出了房间'</span>, roomInfo[roomID]);</span><br><span class="line">    <span class="built_in">console</span>.log(user + <span class="string">'退出了'</span> + roomID);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收用户消息,发送相应的房间</span></span><br><span class="line">  socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 验证如果用户不在房间内则不给发送</span></span><br><span class="line">    <span class="keyword">if</span> (roomInfo[roomID].indexOf(user) === -<span class="number">1</span>) &#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    socketIO.to(roomID).emit(<span class="string">'msg'</span>, user, msg);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// room page</span></span><br><span class="line">router.get(<span class="string">'/room/:roomID'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> roomID = req.params.roomID;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染页面数据(见views/room.hbs)</span></span><br><span class="line">  res.render(<span class="string">'room'</span>, &#123;</span><br><span class="line">    roomID: roomID,</span><br><span class="line">    users: roomInfo[roomID]</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/'</span>, router);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server listening on port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h6 id="客户端代码">客户端代码</h6><p>新增<code>chatapp/views/room.hbs</code><br><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span></span><span class="expression">&#123;&#123;<span class="variable">roomID</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="id">#msglog</span>, <span class="id">#messageInput</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> solid <span class="hexcolor">#ccc</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">500px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">350px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">overflow-y</span>:<span class="value"> auto</span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">14px</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="id">#messageInput</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">80px</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="class">.message</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">22px</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="class">.message</span> <span class="class">.user</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">padding-right</span>:<span class="value"> <span class="number">5px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">padding-left</span>:<span class="value"> <span class="number">5px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">color</span>:<span class="value"> brown</span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="class">.sysMsg</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#c1bfbf</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">padding-right</span>:<span class="value"> <span class="number">5px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">padding-left</span>:<span class="value"> <span class="number">5px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">12px</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="id">#users</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">490px</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span> <span class="number">5px</span> <span class="number">5px</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  昵称: <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"userName"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">  房间: </span><span class="expression">&#123;&#123;<span class="variable">roomID</span>&#125;&#125;</span><span class="xml"> <span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">  当前在线人数: <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"count"</span>&gt;</span></span><span class="expression">&#123;&#123;<span class="variable">users.length</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">  在线用户:  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"users"</span>&gt;</span></span><span class="expression">&#123;&#123;<span class="variable">users</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"msglog"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">name</span>=<span class="value">"message"</span> <span class="attribute">id</span>=<span class="value">"messageInput"</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">  按Enter键发送</span><br><span class="line">  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">id</span>=<span class="value">"joinOrLeave"</span>&gt;</span>退出房间<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/socket.io/socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/js/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ----------设置昵称-------------</span></span><br><span class="line">      <span class="keyword">var</span> userName = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">while</span> ($(<span class="string">'#userName'</span>).text().trim() === <span class="string">''</span>) &#123;</span><br><span class="line">        userName = prompt(<span class="string">"请设置你的昵称"</span>,<span class="string">""</span>);</span><br><span class="line">        $(<span class="string">'#userName'</span>).text(userName);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ---------创建连接-----------</span></span><br><span class="line">      <span class="keyword">var</span> socket = io();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 加入房间</span></span><br><span class="line">      socket.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        socket.emit(<span class="string">'join'</span>, userName);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 监听消息</span></span><br><span class="line">      socket.on(<span class="string">'msg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">userName, msg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> message = <span class="string">''</span> +</span><br><span class="line">            <span class="string">'&lt;div class="message"&gt;'</span> +</span><br><span class="line">            <span class="string">'  &lt;span class="user"&gt;'</span> + userName + <span class="string">': &lt;/span&gt;'</span> +</span><br><span class="line">            <span class="string">'  &lt;span class="msg"&gt;'</span> + msg + <span class="string">'&lt;/span&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">        $(<span class="string">'#msglog'</span>).append(message);</span><br><span class="line">        <span class="comment">// 滚动条保持最下方</span></span><br><span class="line">        $(<span class="string">'#msglog'</span>).scrollTop($(<span class="string">'#msglog'</span>)[<span class="number">0</span>].scrollHeight);  </span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 监听系统消息</span></span><br><span class="line">      socket.on(<span class="string">'sys'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">sysMsg, users</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> message = <span class="string">'&lt;div class="sysMsg"&gt;'</span> + sysMsg + <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">        $(<span class="string">'#msglog'</span>).append(message);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">'#count'</span>).text(users.length);</span><br><span class="line">        $(<span class="string">'#users'</span>).text(users);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 发送消息</span></span><br><span class="line">      $(<span class="string">'#messageInput'</span>).keydown(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.which === <span class="number">13</span>) &#123;</span><br><span class="line">          e.preventDefault();</span><br><span class="line">          <span class="keyword">var</span> msg = $(<span class="keyword">this</span>).val();</span><br><span class="line">          $(<span class="keyword">this</span>).val(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">          socket.send(msg);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 退出房间</span></span><br><span class="line">      $(<span class="string">'#joinOrLeave'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="keyword">this</span>).text() === <span class="string">'退出房间'</span>) &#123;</span><br><span class="line">          $(<span class="keyword">this</span>).text(<span class="string">'进入房间'</span>);</span><br><span class="line">          socket.emit(<span class="string">'leave'</span>);</span><br><span class="line">          <span class="keyword">var</span> msg = <span class="string">'你已经退出了房间,重新发言请点击"进入房间"'</span>;</span><br><span class="line">          $(<span class="string">'#msglog'</span>).append(<span class="string">'&lt;div class="sysMsg"&gt;'</span>+msg+<span class="string">'&lt;/div&gt;'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          $(<span class="keyword">this</span>).text(<span class="string">'退出房间'</span>);</span><br><span class="line">          socket.emit(<span class="string">'join'</span>, userName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>新增 <code>chatapp/public/index.html</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>demo<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  欢迎您,骚年</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">p</span>&gt;</span>房间列表<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_1"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_1"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>1号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_2"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_2"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>2号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_3"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_3"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>3号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_4"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_4"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>4号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_5"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_5"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>5号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_6"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_6"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>6号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_7"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_7"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>7号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_8"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_8"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>8号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_9"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_9"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>9号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">id</span>=<span class="value">"room_10"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/room/room_10"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span>10号房间<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h6 id="运行效果">运行效果</h6><p><img src="http://7xkphs.com1.z0.glb.clouddn.com/myblogQQ20150813-1.png?attname=&amp;e=1439634496&amp;token=Qpp5s4CjgeFOxLTF_C10bJRqmvv6sXUbWzUR5OuV:9xYyBA_02d66AiAllv9f5U0gGGk" alt="运行效果"></p>
<blockquote>
<p>代码已放在github <a href="https://github.com/wuyanxin/chatapp-demo.git" target="_blank" rel="external">https://github.com/wuyanxin/chatapp-demo.git</a></p>
</blockquote>
<h6 id="参考：">参考：</h6><p><a href="http://socket.io/docs/rooms-and-namespaces/" target="_blank" rel="external">http://socket.io/docs/rooms-and-namespaces/</a><br><a href="http://blog.fens.me/nodejs-socketio-chat/" target="_blank" rel="external">http://blog.fens.me/nodejs-socketio-chat/</a><br><a href="http://www.jianshu.com/p/d9b1273a93fd" target="_blank" rel="external">http://www.jianshu.com/p/d9b1273a93fd</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/node_imagemagick.html" itemprop="url">
                node.js中使用imagemagick进行图片裁剪压缩
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-07T17:45:47+08:00" content="2015-08-07">
            2015-08-07
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/node_imagemagick.html#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="node_imagemagick.html" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ol>
<li><p>安装imagemagick</p>
<pre><code>sudo apt-<span class="keyword">get</span> install imagemagick
</code></pre><p> or</p>
<pre><code>wget http:<span class="comment">//www.imagemagick.org/download/ImageMagick.tar.gz</span>
tar zxvf ImageMagick<span class="class">.tar</span><span class="class">.gz</span>
cd ImageMagick
./configure --prefix=/usr/local
make
sudo make install
</code></pre></li>
<li><p>安装GraphicsMagick for node <a href="http://aheckmann.github.com/gm/" target="_blank" rel="external">http://aheckmann.github.com/gm/</a></p>
<pre><code>npm <span class="keyword">install</span> gm
</code></pre></li>
</ol>
<ol>
<li><p>node.js代码</p>
<pre><code><span class="keyword">var</span> fs, gm;
gm = <span class="built_in">require</span>(<span class="string">'gm'</span>);

gm(<span class="string">'./img/before.jpg'</span>).options({
  imageMagick: <span class="literal">true</span>
}).resize(<span class="number">130</span>, <span class="number">105</span>).write(<span class="string">'./img/after.jpg'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) {
    <span class="keyword">return</span> <span class="built_in">console</span>.error(err);
  }
  <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'success'</span>);
});
</code></pre><p> 使用文件流：</p>
<pre><code>var fs, gm;
gm = require<span class="params">('gm')</span>;
fs = require<span class="params">('fs')</span>;

gm<span class="params">(fs.createReadStream<span class="params">('./img/before.jpg')</span>)</span>.options<span class="params">({
  imageMagick: <span class="literal">true</span>
})</span>.<span class="built_in">resize</span><span class="params">(<span class="number">130</span>, <span class="number">105</span>)</span>.stream<span class="params">()</span>.pipe<span class="params">(fs.createWriteStream<span class="params">('./img/after.jpg')</span>)</span>;
</code></pre><p> 处理网上图片：</p>
<pre><code>var fs, gm, request;
gm = require<span class="params">('gm')</span>;
fs = require<span class="params">('fs')</span>;
request = require<span class="params">('request')</span>;

gm<span class="params">(request<span class="params">('http://url_to_img.jpg')</span>)</span>.options<span class="params">({
  imageMagick: <span class="literal">true</span>
})</span>.<span class="built_in">resize</span><span class="params">(<span class="number">130</span>, <span class="number">105</span>)</span>.stream<span class="params">()</span>.pipe<span class="params">(fs.createWriteStream<span class="params">('./img/after.jpg')</span>)</span>;
</code></pre></li>
</ol>
<h4 id="错误处理">错误处理</h4><ol>
<li><p>如出现以下错误，请参考：<a href="http://t.cn/R7I5ip3" target="_blank" rel="external">http://t.cn/R7I5ip3</a></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">convert: <span class="keyword">no</span> <span class="keyword">decode</span> delegate <span class="keyword">for</span> this image <span class="keyword">format</span> <span class="label">`JPEG'</span> @ <span class="keyword">error</span>/constitute.c/ReadImage/501.</span><br><span class="line">convert: <span class="keyword">no</span> images defined `img/after.jpg' @ <span class="keyword">error</span>/convert.c/ConvertImageCommand/3212.</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果configure提示“configure: error: libltdl is required for modules build”，则yum search ltdl，然后（以CentOS 6.3 64bit 为例）</p>
<pre><code>yum <span class="keyword">install</span> libtool-ltdl.x86_64
yum <span class="keyword">install</span> libtool-ltdl-devel.x86_64
</code></pre></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/js_quick_sort.html" itemprop="url">
                javascript实现快速排序算法
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-07-30T17:49:02+08:00" content="2015-07-30">
            2015-07-30
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/js/" itemprop="url" rel="index">
                  <span itemprop="name">js</span>
                </a>
              </span>

              
              
                ， 
              

            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/js/算法/" itemprop="url" rel="index">
                  <span itemprop="name">算法</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/js_quick_sort.html#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="js_quick_sort.html" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>忘记了快速排序的思路是怎样的了，复习一下，写了两个实例，发表博文备忘。</p>
<p><strong>对于快速排序的思想，可以参考<a href="http://blog.csdn.net/morewindows/article/details/6684558" target="_blank" rel="external">白话经典算法系列之六 快速排序 快速搞定</a>，讲得比较通俗</strong></p>
<h3 id="prototype扩展的方式">prototype扩展的方式</h3><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 对<span class="type">Array</span>对象的原型扩展来实现快速排序</span><br><span class="line"> * @param [left]  排序开始位置</span><br><span class="line"> * @param [right]  排序结束位置</span><br><span class="line"> * @returns &#123;<span class="type">Array</span>&#125;</span><br><span class="line"> */</span><br><span class="line"><span class="type">Array</span>.prototype.quickSort = function(left, right)&#123;</span><br><span class="line">    <span class="keyword">if</span>(left === undefined)   left = <span class="number">0</span>;      //若left和right为空，设置初始值</span><br><span class="line">    <span class="keyword">if</span>(right === undefined)   right = this.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(left &lt; right)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">ref</span> = this[left];</span><br><span class="line">        <span class="keyword">var</span> low = left;</span><br><span class="line">        <span class="keyword">var</span> high = right;</span><br><span class="line">        <span class="keyword">while</span>(low &lt; high)&#123;</span><br><span class="line">            //从右往左查询比<span class="keyword">ref</span>小的值</span><br><span class="line">            <span class="keyword">while</span>(low &lt; high &amp;&amp; this[high] &gt; <span class="keyword">ref</span>)&#123;</span><br><span class="line">                --high;</span><br><span class="line">            &#125;</span><br><span class="line">            this[low] = this[high];</span><br><span class="line">            //从左往右查询比<span class="keyword">ref</span>大的值</span><br><span class="line">            <span class="keyword">while</span>(low &lt; high &amp;&amp; this[low] &lt; <span class="keyword">ref</span>)&#123;</span><br><span class="line">                ++low</span><br><span class="line">            &#125;</span><br><span class="line">            this[high] = this[low];</span><br><span class="line">        &#125;</span><br><span class="line">        this[low] = <span class="keyword">ref</span>;</span><br><span class="line">        this.quickSort(low+<span class="number">1</span>, right);</span><br><span class="line">        this.quickSort(left, low-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">95</span>,<span class="number">8</span>,<span class="number">65</span>,<span class="number">98</span>,<span class="number">54</span>,<span class="number">25</span>,<span class="number">3</span>,<span class="number">654</span>,<span class="number">4</span>,<span class="number">74</span>,<span class="number">63</span>,<span class="number">88</span>,<span class="number">35</span>,<span class="number">68</span>];</span><br><span class="line">console.log(arr1.quickSort());</span><br></pre></td></tr></table></figure>
<h3 id="非prototype方式">非prototype方式</h3><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param <span class="type">array</span> //要排序的数组</span><br><span class="line"> * @returns &#123;<span class="type">Array</span>&#125; //排完序的数组</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">var</span> quicksort = function(<span class="type">array</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="type">array</span>.length)   <span class="keyword">return</span> <span class="type">array</span>;</span><br><span class="line">    <span class="keyword">var</span> low = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> high = <span class="type">array</span>.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">ref</span> = <span class="type">array</span>[low];</span><br><span class="line">    <span class="keyword">while</span>(low &lt; high)&#123;</span><br><span class="line">        <span class="keyword">while</span>(low &lt; high &amp;&amp; <span class="type">array</span>[high] &gt; <span class="keyword">ref</span>)&#123;</span><br><span class="line">            --high;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">array</span>[low] = <span class="type">array</span>[high];</span><br><span class="line">        <span class="keyword">while</span>(low &lt; high &amp;&amp; <span class="type">array</span>[low] &lt; <span class="keyword">ref</span>)&#123;</span><br><span class="line">            ++low</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">array</span>[high] = <span class="type">array</span>[low];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">array</span>[low] = <span class="keyword">ref</span>;</span><br><span class="line">    <span class="keyword">return</span> quicksort(<span class="type">array</span>.slice(<span class="number">0</span>,low)).concat([<span class="keyword">ref</span>],quicksort(<span class="type">array</span>.slice(low+<span class="number">1</span>, <span class="type">array</span>.length)));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">95</span>,<span class="number">8</span>,<span class="number">65</span>,<span class="number">98</span>,<span class="number">54</span>,<span class="number">25</span>,<span class="number">3</span>,<span class="number">654</span>,<span class="number">4</span>,<span class="number">74</span>,<span class="number">63</span>,<span class="number">88</span>,<span class="number">35</span>,<span class="number">68</span>];</span><br><span class="line">console.log(quicksort(arr2));</span><br></pre></td></tr></table></figure></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/redis_study.html" itemprop="url">
                Redis简易入门教程
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-07-28T00:00:00+08:00" content="2015-07-28">
            2015-07-28
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/redis_study.html#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="redis_study.html" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="简介">简介</h3><p>Remote Dictionary Server (Redis)<br>Redis是一个开源的高性能键值对数据库。它通过提供多种键值数据类型来适应不同场景下的存储需求，并借助许多高层级的接口使其可以胜任如缓存、队列系统等不同的角色。  </p>
<p>它跟memcached类似，不过数据可以持久化，而且支持的数据类型很丰富。</p>
<p>截止到2015年6月27日，发布的最新稳定版本是3.0.2。<br>3.0版本最大的提升就是redis集群，一个分布式的redis示例具有数据自动分片和高容错性，以及在高负载的情况下的速度提升。</p>
<h3 id="安装、配置">安装、配置</h3><h4 id="安装">安装</h4><p>下载路径： <a href="http://redis.io/download" target="_blank" rel="external">http://redis.io/download</a></p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">安装命令</span><br><span class="line"><span class="char">$ </span>wget <span class="method">http:</span>//download.redis.io/releases/redis-<span class="number">3.0</span>.2.tar.gz</span><br><span class="line"><span class="char">$ </span>tar xzf redis-<span class="number">3.0</span>.2.tar.gz</span><br><span class="line"><span class="char">$ </span>cd redis-<span class="number">3.0</span>.2</span><br><span class="line"><span class="char">$ </span>make</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line"><span class="char">$ </span>src/redis-server</span><br><span class="line"></span><br><span class="line">客户端</span><br><span class="line"><span class="char">$ </span>src/redis-cli</span><br><span class="line">redis&gt; set foo bar</span><br><span class="line"><span class="class">OK</span></span><br><span class="line">redis&gt; get foo</span><br><span class="line"><span class="comment">"bar"</span></span><br></pre></td></tr></table></figure>
<h4 id="配置">配置</h4><p>redis的配置示例文件在%REDIS_HOME%下的redis.conf<br>里面包含很多默认配置<br>使用配置可以这样：$ redis-server /etc/redis/6379.conf</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">daemonize 如果需要在后台运行，把该项改为yes</span><br><span class="line"></span><br><span class="line">pidfile 配置多个pid的地址，默认在/var/run/redis.pid</span><br><span class="line"></span><br><span class="line">bind 绑定ip，设置后只接受自该ip的请求</span><br><span class="line"></span><br><span class="line">port 监听端口，默认为<span class="number">6379</span></span><br><span class="line"></span><br><span class="line">timeout 设置客户端连接时的超时时间，单位为秒</span><br><span class="line"></span><br><span class="line">loglevel 分为<span class="number">4</span>级，<span class="keyword">debug</span>、<span class="keyword">verbose</span>、notice、warning</span><br><span class="line"></span><br><span class="line">logfile 配置<span class="built_in">log</span>文件地址</span><br><span class="line"></span><br><span class="line">databases 设置数据库的个数，默认使用的数据库为<span class="number">0</span></span><br><span class="line"></span><br><span class="line">save &lt;seconds&gt; &lt;<span class="keyword">changes</span>&gt; 设置redis进行数据库镜像的频率，保存快照的频率。  </span><br><span class="line">	第一个参数表示多长时间，第二个表示执行多少次写操作。</span><br><span class="line">	在一定时间内执行一定数量的写操作时，自动保存快照。可设置多个条件。</span><br><span class="line"></span><br><span class="line">rdbcompression 在进行镜像备份时，是否进行压缩</span><br><span class="line"></span><br><span class="line">Dbfilename 镜像备份文件的文件名</span><br><span class="line"></span><br><span class="line">Dir 数据库镜像备份的文件放置路径</span><br><span class="line"></span><br><span class="line">Slaveof 设置数据库为其他数据库的从数据库 </span><br><span class="line"></span><br><span class="line">Masterauth 主数据库连接需要的密码验证</span><br><span class="line"></span><br><span class="line">Requirepass 设置登录时需要使用的密码</span><br><span class="line"></span><br><span class="line">Maxclients 限制同时连接的客户数量</span><br><span class="line"></span><br><span class="line">Maxmemory 设置redis能够使用的最大内存</span><br><span class="line"></span><br><span class="line">Appendonly 开启<span class="built_in">append</span> <span class="keyword">only</span>模式</span><br><span class="line"></span><br><span class="line">appendfsync 设置对appendonly.aof文件同步的频率</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-enabled 是否虚拟内存的支持</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-swap-<span class="keyword">file</span> 设置虚拟内存的交换文件路径</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-<span class="built_in">max</span>-memory 设置redis使用的最大物理内存大小</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-page-size 设置虚拟内存的页大小</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-pages 设置交换文件的总page数量</span><br><span class="line"></span><br><span class="line"><span class="keyword">vm</span>-<span class="built_in">max</span>-threads 设置VMIO同时使用的线程数量</span><br><span class="line"></span><br><span class="line">glueoutputbuf 把小的输出缓存存放在一起</span><br><span class="line"></span><br><span class="line">hash-<span class="built_in">max</span>-zipmap-entries 设置hash的临界值</span><br><span class="line"></span><br><span class="line">activerehashing 重新hash</span><br></pre></td></tr></table></figure>
<p>详情可参考：<a href="http://t.cn/8kr3HUw" target="_blank" rel="external">http://t.cn/8kr3HUw</a></p>
<h3 id="数据结构及其使用场景">数据结构及其使用场景</h3><p>1 string 字符类型<br>2 hash 散列类型<br>3 list 列表类型<br>4 set 集合类型<br>5 sorted set 有序集合</p>
<h4 id="string_字符串类型">string 字符串类型</h4><p>字符串类型是redis最基础的数据类型，是其他4中数据类型的基础。  </p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SET key value</td>
<td style="text-align:left">赋值</td>
<td style="text-align:left">set foo 5 ==&gt; OK</td>
</tr>
<tr>
<td style="text-align:left">GET key</td>
<td style="text-align:left">取值</td>
<td style="text-align:left">get foo ==&gt; “5”</td>
</tr>
<tr>
<td style="text-align:left">INCR key</td>
<td style="text-align:left">递增.键不存在时创建并赋0，否则+1</td>
<td style="text-align:left">incr foo ==&gt; 6</td>
</tr>
<tr>
<td style="text-align:left">DECR key</td>
<td style="text-align:left">递减</td>
<td style="text-align:left">decr foo ==&gt; 5</td>
</tr>
<tr>
<td style="text-align:left">INCRBY key num</td>
<td style="text-align:left">与incr一样，不过可以指定增加的数值</td>
<td style="text-align:left">incrby foo 5 ==&gt; 10</td>
</tr>
<tr>
<td style="text-align:left">APPEND key value</td>
<td style="text-align:left">追加,返回追加后字符串长度</td>
<td style="text-align:left">append foo 24 ==&gt; 4</td>
</tr>
<tr>
<td style="text-align:left">STRLEN key</td>
<td style="text-align:left">长度</td>
<td style="text-align:left">strlen foo ==&gt; 4</td>
</tr>
<tr>
<td style="text-align:left">MSET key value[ key value…]</td>
<td style="text-align:left">同时设置多个键值</td>
<td style="text-align:left">mset key1 1 key2 2 ==&gt; OK</td>
</tr>
<tr>
<td style="text-align:left">MGET key[ key…]</td>
<td style="text-align:left">同时获取多个键值</td>
<td style="text-align:left">mget key1 key2 ==&gt;”1” “2”</td>
</tr>
</tbody>
</table>
<p>字符串就介绍到这里了，还有其他命令请自行看<a href="http://redis.io/commands" target="_blank" rel="external">官方文档</a> 😂😂😂</p>
<h3 id="hash_散列类型">hash 散列类型</h3><p>散列类型是一个键值数据结构，其值只能是字符串，也就是散列数据类型不支持嵌套其他数据类型。  </p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HSET key field value</td>
<td style="text-align:left">设置或修改字段值</td>
<td style="text-align:left">hset user name frek ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">HGET key field</td>
<td style="text-align:left">获取字段值</td>
<td style="text-align:left">hget user name ==&gt; “frek”</td>
</tr>
<tr>
<td style="text-align:left">HMSET key field value[ field value..]</td>
<td style="text-align:left">同时设置多个字段</td>
<td style="text-align:left">hmset user name frek age 18 ==&gt; OK</td>
</tr>
<tr>
<td style="text-align:left">HMGET key field[ field..]</td>
<td style="text-align:left">同时获取多个字段值</td>
<td style="text-align:left">hmget user name age ==&gt; “frek” “18”</td>
</tr>
<tr>
<td style="text-align:left">HGETALL key</td>
<td style="text-align:left">获取键中所有字段和值</td>
<td style="text-align:left">hgetall user ==&gt; “name” “frek” “age” “18”</td>
</tr>
<tr>
<td style="text-align:left">HEXISTS key field</td>
<td style="text-align:left">判断字段是否存在，存在返回1，否则返回0（如果键不存在也返回0）</td>
<td style="text-align:left">hexists user email ==&gt; 0</td>
</tr>
<tr>
<td style="text-align:left">HSETNX key field value</td>
<td style="text-align:left">当字段不存在时赋值</td>
<td style="text-align:left">hsetnx user name sam ==&gt; 0 ; HSETNX user email xxx@xxx.com ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">HINCRBY key field increment</td>
<td style="text-align:left">参考incrby命令</td>
<td style="text-align:left">hincrby user age 1 ==&gt; 19</td>
</tr>
<tr>
<td style="text-align:left">HKEYS key</td>
<td style="text-align:left">获取键中所有字段名</td>
<td style="text-align:left">hkeys user ==&gt; “name” “age” “email”</td>
</tr>
<tr>
<td style="text-align:left">HVALS key</td>
<td style="text-align:left">获取所有的字段值</td>
<td style="text-align:left">hvals user ==&gt; “frek” “19” “xxx@xxx.com”</td>
</tr>
<tr>
<td style="text-align:left">HLEN key</td>
<td style="text-align:left">获取字段数量</td>
<td style="text-align:left">hlen user ==&gt; 3</td>
</tr>
<tr>
<td style="text-align:left">HDEL key field[ field..]</td>
<td style="text-align:left">删除一个或多个字段,返回删除的字段数</td>
<td style="text-align:left">hdel user email age ==&gt; 2</td>
</tr>
</tbody>
</table>
<h3 id="list_列表类型">list 列表类型</h3><p>列表类型可以存储一个有序的字符串列表</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LPUSH key value[ value..]</td>
<td style="text-align:left">向列表的左边增加元素，返回增加元素后列表的长度</td>
<td style="text-align:left">lpush users fred sam alice ==&gt; 3</td>
</tr>
<tr>
<td style="text-align:left">RPUSH key value[ value..]</td>
<td style="text-align:left">向列表的右边增加元素</td>
<td style="text-align:left">rpush users carl lisa nicesu ==&gt; 6</td>
</tr>
<tr>
<td style="text-align:left">LPOP key</td>
<td style="text-align:left">从列表左边移除一个元素，并返回该元素值</td>
<td style="text-align:left">lpop users ==&gt; “fred”</td>
</tr>
<tr>
<td style="text-align:left">RPOP key</td>
<td style="text-align:left">从列表的右侧移除一个元素，并返回该元素值</td>
<td style="text-align:left">rpop users ==&gt; “nicesu”</td>
</tr>
<tr>
<td style="text-align:left">LLEN key</td>
<td style="text-align:left">返回列表元素个数，键不存在时返回0</td>
<td style="text-align:left">llen users ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">LRANGE key start stop</td>
<td style="text-align:left">获取列表片段，start和stop支持负数，-1表示右数第一个</td>
<td style="text-align:left">lrange users 0 -1 ==&gt; “sam” “alice” “carl” “lisa”</td>
</tr>
<tr>
<td style="text-align:left">LREM key count value</td>
<td style="text-align:left">删除列表中指定的值，返回删除的元素个数</td>
<td style="text-align:left">lrem users 2 sam ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">LINDEX key index</td>
<td style="text-align:left">获取指定索引元素值</td>
<td style="text-align:left">lindex users 0 ==&gt; “carl”</td>
</tr>
<tr>
<td style="text-align:left">LSET key index value</td>
<td style="text-align:left">设置指定索引的元素值</td>
<td style="text-align:left">lset users 0 allen ==&gt; OK</td>
</tr>
<tr>
<td style="text-align:left">LTRIM key start end</td>
<td style="text-align:left">只保留列表指定片段，删除其他元素</td>
<td style="text-align:left">ltrim users 0 1 ==&gt; OK</td>
</tr>
<tr>
<td style="text-align:left">LINSERT key BEFORE/AFTER pivot value</td>
<td style="text-align:left">向列表插入元素,返回插入后列表长度</td>
<td style="text-align:left">linsert users after carl adam ==&gt; 3</td>
</tr>
<tr>
<td style="text-align:left">RPOPLPUSH source destination</td>
<td style="text-align:left">将一个元素从一个列表转移到另一个列表，对source执行rpop，对destination执行lpush，返回被移动的元素值</td>
<td style="text-align:left">rpoplpush users usernames ==&gt; “adam”</td>
</tr>
</tbody>
</table>
<h3 id="集合类型">集合类型</h3><p>集合中的每个元素都不同，且没有顺序</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SADD key member[ member..]</td>
<td style="text-align:left">增加一个或多个元素</td>
<td style="text-align:left">sadd tags one two three two ==&gt; 3</td>
</tr>
<tr>
<td style="text-align:left">SREM key member[ member..]</td>
<td style="text-align:left">移除一个或多个元素</td>
<td style="text-align:left">srem tags two ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">SMEMBERS key</td>
<td style="text-align:left">获取集合中所有的元素</td>
<td style="text-align:left">smembers tags ==&gt; “three” “one”</td>
</tr>
<tr>
<td style="text-align:left">SISMEMBER key member</td>
<td style="text-align:left">判断元素是否存在集合中</td>
<td style="text-align:left">sismember tags one ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">SCARD key</td>
<td style="text-align:left">获取集合的元素个数</td>
<td style="text-align:left">scard tags ==&gt; 2</td>
</tr>
<tr>
<td style="text-align:left">SRANDMEMBER key[ count]</td>
<td style="text-align:left">返回1个或count个随机元素</td>
<td style="text-align:left">srandmember tags ==&gt; “one”</td>
</tr>
<tr>
<td style="text-align:left">SDIFF key[ key..]</td>
<td style="text-align:left">集合差运算</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">SINTER key[ key..]</td>
<td style="text-align:left">集合交集运算</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">SUNION key[ key..]</td>
<td style="text-align:left">集合并集运算</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3 id="有序集合类型">有序集合类型</h3><p>在集合类型的基础上有序集合类型为每个元素都关联了一个分数，这使我们可以使用集合类型的操作之外，还能做与分数有关的操作。</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ZADD key score member[ score member..]</td>
<td style="text-align:left">增加一个带分数的元素，如果已存在，则替换分数</td>
<td style="text-align:left">zadd scoreboard 60 fred 89 parker 76 tony 59 nicesu ==&gt; 4</td>
</tr>
<tr>
<td style="text-align:left">ZSCORE key member</td>
<td style="text-align:left">获得元素分数</td>
<td style="text-align:left">ZSCORE scoreboard nicesu ==&gt; “59”</td>
</tr>
<tr>
<td style="text-align:left">ZRANGE key start end[ WITHSCORES]</td>
<td style="text-align:left">获得排名在某个范围内的元素，返回按score升序排序的元素</td>
<td style="text-align:left">zrange scoreboard 0 -1 ==&gt; “nicesu” “fred” “tony” “parker”</td>
</tr>
<tr>
<td style="text-align:left">ZREVRANGE key start end[ WITHSCORES]</td>
<td style="text-align:left">与zrange使用一致，返回按score降序的元素</td>
<td style="text-align:left">zrevrange scoreboard 0 -1 withscores ==&gt; “parker” “89” “tony” “76” “fred” “60” “nicesu” “59”</td>
</tr>
<tr>
<td style="text-align:left">ZRANGEBYSCORE key min max[ WITHSCORES][LIMIT offset count]</td>
<td style="text-align:left">获得指定分数范围内的元素</td>
<td style="text-align:left">zrangebyscore scoreboard 60 100 ==&gt; “fred” “tony” “parker”</td>
</tr>
<tr>
<td style="text-align:left">ZREVRANGEBYSCORE key max min[ WITHSCORES][LIMIT offset count]</td>
<td style="text-align:left">获得指定分数范围内的元素,降序排序</td>
<td style="text-align:left">zrevrangebyscore scoreboard 100 60 ==&gt; “parker” “tony” “fred”</td>
</tr>
<tr>
<td style="text-align:left">ZINCREBY key increment member</td>
<td style="text-align:left">增加某个元素的分数</td>
<td style="text-align:left">zincrby scoreboard 1 nicesu ==&gt; 60</td>
</tr>
<tr>
<td style="text-align:left">ZCARD key</td>
<td style="text-align:left">获取集合中元素个数</td>
<td style="text-align:left">zcard scoreboard ==&gt; 4</td>
</tr>
<tr>
<td style="text-align:left">ZCOUNT KEY min max</td>
<td style="text-align:left">获得指定分数范围内的元素个数</td>
<td style="text-align:left">zcount scoreboard 80 100 ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">ZREM key member[ member..]</td>
<td style="text-align:left">删除一个或多个元素</td>
<td style="text-align:left">zrem scoreboard nicesu ==&gt; 1</td>
</tr>
<tr>
<td style="text-align:left">ZRANK key member</td>
<td style="text-align:left">获取分数从小到大排序的位置</td>
<td style="text-align:left">zrank scoreboard parker ==&gt; 2</td>
</tr>
<tr>
<td style="text-align:left">ZREVRANK key member</td>
<td style="text-align:left">同上</td>
<td style="text-align:left">zrevrank scoreboard parker ==&gt; 0</td>
</tr>
<tr>
<td style="text-align:left">ZREMRANGEBYRANK key start stop</td>
<td style="text-align:left">按照排名范围删除元素</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">ZREMRANGEBYSCORE key min max</td>
<td style="text-align:left">按分数范围内删除元素</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3 id="redis与node-js">redis与node.js</h3><h5 id="安装：">安装：</h5><p><code>npm install redis</code><br>还可以安装C语言写的redis库<br><code>npm install hiredis redis</code><br>如果安装了hiredis，node_redis会默认调用hiredis提供的库  </p>
<h5 id="示例：">示例：</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> redis = <span class="keyword">require</span>(<span class="string">"redis"</span>),</span><br><span class="line"><span class="comment">// redis.createClient(port, host, option)</span></span><br><span class="line">   client = redis.createClient(<span class="number">6379</span>, <span class="string">'127.0.0.1'</span>, &#123;auth_pass: <span class="string">'password'</span>&#125;);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 如果需要切换数据库，如下操作</span></span><br><span class="line">   <span class="comment">// client.select(3, function() &#123; /* ... */ &#125;);</span></span><br><span class="line"></span><br><span class="line">   client.on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>&#123;</span><br><span class="line">       console.log(<span class="string">"Error "</span> + err);</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   client.set(<span class="string">"string key"</span>, <span class="string">"string val"</span>, redis.<span class="keyword">print</span>);</span><br><span class="line">   client.hset(<span class="string">"hash key"</span>, <span class="string">"hashtest 1"</span>, <span class="string">"some value"</span>, redis.<span class="keyword">print</span>);</span><br><span class="line">   client.hset([<span class="string">"hash key"</span>, <span class="string">"hashtest 2"</span>, <span class="string">"some other value"</span>], redis.<span class="keyword">print</span>);</span><br><span class="line">   client.hkeys(<span class="string">"hash key"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err, replies)</span> </span>&#123;</span><br><span class="line">       console.log(replies.length + <span class="string">" replies:"</span>);</span><br><span class="line">       replies.<span class="keyword">forEach</span>(<span class="function"><span class="keyword">function</span> <span class="params">(reply, i)</span> </span>&#123;</span><br><span class="line">           console.log(<span class="string">"    "</span> + i + <span class="string">": "</span> + reply);</span><br><span class="line">       &#125;);</span><br><span class="line">       client.quit();</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
<p>像mset可以多参数的命令，参数可以使用数组的方式传：<br><code>client.mset(key1, val1, ... keyn, valn, [callback]);</code><br>等价于<br><code>client.mset([key1, val1, ... keyn, valn], [callback]);</code>  </p>
<p>hmset可以接受多参数和对象<br><code>client.hmset(hashkey, key1, val1, ... keyn, valn, [callback])</code><br>等价于<br><code>client.hmset(hashkey, obj, [callback])</code>  </p>
<p>更多命令使用请参考:  <a href="https://github.com/NodeRedis/node_redis" target="_blank" rel="external">https://github.com/NodeRedis/node_redis</a> 🐵</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
 </div>

        <!-- baidu tuijian -->
        <div id="hm_t_78328"></div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="吴彦欣" itemprop="image"/>
          <p class="site-author-name" itemprop="name">吴彦欣</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">5</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuyanxin" target="_blank">github</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zpup" target="_blank">微博</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuyanxin" target="_blank">知乎</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/6f1b27b45dd9" target="_blank">简书</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴彦欣</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-wuyanxin-hexo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
